<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.js"></script>
    <script src="js/script.js"></script>
    <link rel="stylesheet" href="css/estilo.css">
</head>

<body>
    <header>
        <div>
            <h1>Carrinho de Compras</h1>
            <% if(autenticado.autenticado){ if(autenticado.login){%>
                <script>
                    notify("Login efetuado com sucesso", "Ol치 <%= autenticado %>", "success", "center")                        
                </script>
                <% } let arquivo={"imagem":"imagem/img-perfil.png"} ; if(autenticado.img_perfil_pasta !=null){
                    arquivo.imagem=autenticado.img_perfil_pasta; }else if(autenticado.img_perfil_banco !=null){
                    arquivo.imagem=autenticado.img_perfil_banco; } %>
                    <span>Ol치 <%= autenticado.autenticado %>!</span><br>
                    <span><a href="/perfil"><img class="icone-perfil" src="<%= arquivo.imagem %>" </a></span>
                    <p><a href="/sair">sair</a></p>

                    <% }else{ %>
                        <span>Ol치 visitante!</span>
                        <p><a href="/login">Login</a></p>
                        <p><a href="/cadastro">Cadastro</a></p>
                        <% } %>
        </div>
    </header>

    <main>
        <% 
        if(carrinho){ %>
            <table>
                <caption>Carrinho</caption>
                <thead>
                    <tr>
                        <th>Codigo Item</th>
                        <th>Produto</th>
                        <th>Imagem</th>
                        <th>Quantidade</th>
                        <th>Valor unit치rio</th>
                        <th>excluir</th>
                    </tr>
                </thead>
                <tbody>
                    <% 
                    var total = 0;
                    carrinho.forEach(function(item){ 
                        total += (item.qtde * item.preco);
                        %>
                        <tr>
                            <td>
                                <%= item.codproduto %>
                            </td>
                            <td>
                                <%= item.produto %>
                            </td>
                            <td>
                                <img class="thumb-cart" src="<%= item.imagem %>" alt="">
                            </td>
                            <td><a href="/addItem?id=<%= item.codproduto %>&preco=<%= item.preco %>"><img
                                        class="icon-cart" src="imagem/add.png" alt=""></a><span class="qtde-cart">
                                    <%= item.qtde %>
                                </span><a href="/removeItem?id=<%= item.codproduto %>&qtde=1"><img class="icon-cart"
                                        src="imagem/remov.png" alt=""></a></td>
                            <td>R$ <%= item.preco.toFixed(2) %>
                            </td>
                            
                            <td><a href="/excluirItem?id=<%= item.codproduto %>"><img src="imagem/excluir.png"
                                        alt=""></a></td>
                        </tr>
                        <tr>
                            <td colspan="2">Sub total</td>
                            <td colspan="4">R$ <%= (item.qtde * item.preco).toFixed(2);  %></td>
                        </tr>

                        <%  }); } %>

                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3"></td>
                        <td colspan="2">Total</td>
                        <td ><%= total.toFixed(2) %></td>
                    </tr>
                </tfoot>
            </table>

    </main>

    <footer>

    </footer>
</body>